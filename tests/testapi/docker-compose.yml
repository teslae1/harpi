
services:
  testapi:
    build: 
      context: ./
      dockerfile: Dockerfile
    image: testapi
    command: node index.js 
    expose:
      - 8080

  harpitests:
    image: harpitests
    build:
      context: ../../
      dockerfile: tests/testapi/HarpiDockerfile
    depends_on:
      - testapi
    command: > 
      /bin/sh -c "
      cd /usr/src/harpi/tests && 
      harpi run test -b --variables baseUrl=http://testapi:8080 && 
      harpi run test_tinyeval -b --variables baseUrl=http://testapi:8080 && 
      (! harpi run test_script_trying_to_access_environment_and_fails -b --variables baseUrl=http://testapi:8080 || exitCode 1)
      "

  
    

